{"version":3,"file":"tester.umd.js","sources":["../src/utils.js","../src/tester.js","../src/ConfigurationClass.js","../src/index.js"],"sourcesContent":["/*\n  Utilities\n*/\n\nfunction getInstance (component) {\n  const instance = component.instance();\n  return instance.wrappedInstance || instance;\n}\n\nfunction getValue (tester, value) {\n  return typeof value === 'function' ? value(tester) : value;\n}\n\nfunction sleep (ms = 0) {\n  return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nfunction capitalize (string) {\n  return string.charAt(0).toUpperCase() + string.slice(1);\n}\n\nexport {\n  capitalize,\n  getInstance,\n  getValue,\n  sleep,\n};\n","import React, { Fragment } from 'react';\n\nimport {\n  getInstance,\n  getValue,\n  sleep,\n} from './utils';\n\nconst NullComponent = (props) => <Fragment {...props} />;\n\n\n/*\n  Name: Tester\n  Description: Testing utility class to mount a specific component with it's required wrappers.\n\n  Usage:\n    // Bootstrap Transport, localStorage + Session and an AppState.\n    const tester = new Tester(MyComponent);\n\n    // Bootstrap nothing, use with light components that doesn't need any of the above.\n    const tester = new TesterLight(MyComponent);\n\n    // Mount the component\n    await tester.mount();\n\n    // Test component that requires more JSX than the component only :\n    const new Tester(MyComponent, {mount: (<Form><MyComponent></Form>)});\n\n    // You can mount right away if no Transport or AppState modification is needed.\n    const tester = await new Tester(MyComponent).mount();\n\n    // opts.shallow is an experimental feature that allows you to test the TestedComponent instance behaviors.\n    // Please only use it when necessary.\n    const tester = await new Tester(MyComponent, { shallow: true }).mount();\n      tester.shallow.wrapper // equals to shallow(<TestedComponent {...this.props} {...this.AppState} />)\n      tester.shallow.instance // equals to tester.shallow.instance()\n*/\n\n/**\n * Testing utility class to mount a specific component with it's required wrappers.\n *\n * @param {ReactComponent} TestedComponent\n * @param {Object} options\n * @returns {Tester}\n */\nclass Tester {\n  config;\n  initialMount;\n  onBeforeMount;\n  opts;\n  profile;\n  props;\n  shallow;\n  TestedComponent;\n  wrapper;\n  wrappers;\n\n  constructor (TestedComponent, opts = {}) {\n    this.config = this.constructor.Configuration;\n    this.opts = opts;\n    this.initialMount = opts.mount;\n    this.onBeforeMount = opts.onBeforeMount;\n    this.profile = {...this.config.profiles.Default, ...opts.profile};\n    this.props = opts.props || {};\n    this.TestedComponent = TestedComponent;\n\n    // Allow testing without a main TestedComponent. This require an initialMount.\n    if (!this.TestedComponent && this.initialMount) {\n      this.TestedComponent = NullComponent;\n      this.initialMount = <this.TestedComponent>{this.initialMount}</this.TestedComponent>;\n    }\n\n    // Loop through hooks onInit(),\n    this.config.getValidHooks(this, 'onInit').forEach((hook) => {\n      hook.onInit(this);\n    });\n  }\n\n  getWrappers () {\n    const wrappers = [];\n\n    this.config.getValidHooks(this, 'component').forEach((hook) => {\n      wrappers.push({\n        component: hook.component,\n        name: hook.name,\n        props: getValue(this, hook.props),\n      });\n    });\n\n    return wrappers;\n  }\n\n  get instance () {\n    return getInstance(this.component);\n  }\n\n  get component () {\n    return this.wrapper.find(this.TestedComponent);\n  }\n\n  debug () {\n    // eslint-disable-next-line no-console\n    console.log(this.wrapper.debug());\n  }\n\n  html () {\n    return this.component.html();\n  }\n\n  text () {\n    return this.component.text();\n  }\n\n  find (selector) {\n    return this.wrapper.find(selector);\n  }\n\n  update () {\n    return this.wrapper.update();\n  }\n\n  async sleep (ms) {\n    await sleep(ms);\n  }\n\n  async refresh (ms) {\n    await sleep(ms);\n    this.update();\n  }\n\n  createShallowWrapper () {\n    this.shallow = {};\n    this.shallow.wrapper = this.config.enzyme.mount(<this.TestedComponent.wrappedComponent {...this.props} { ...this.AppState } />);\n    this.shallow.instance = getInstance(this.shallow.wrapper);\n  }\n\n  async mount (mountOpts = {}) {\n\n    // Loop through hooks onBeforeMount(),\n    // This MUST be a regular for () loop to not throw the promise away. (forEach won't work)\n    for (const hook of this.config.getValidHooks(this, 'onBeforeMount')) {\n      await hook.onBeforeMount(this, mountOpts);\n    }\n\n    // Allows you to fetch data to set as props, prepare extra stores, etc.\n    if (this.onBeforeMount) {\n      await this.onBeforeMount(this);\n    }\n\n    const initialMount = this.initialMount || <this.TestedComponent {...this.props} />;\n\n    const WrapperTree = this.getWrappers().reduce((Tree, wrapper) => {\n      const wrapperChildren = wrapper.renderChildren !== false && Tree;\n      if (wrapper.props) {\n        return <wrapper.component {...wrapper.props}>{wrapperChildren}</wrapper.component>;\n      }\n      return Tree;\n    }, initialMount);\n\n    this.wrapper = await this.config.enzyme.mount(WrapperTree);\n\n    if (this.opts.shallow) {\n      this.createShallowWrapper();\n    }\n\n    if (mountOpts.async) {\n      await this.sleep();\n      this.update();\n    }\n\n    return this;\n  }\n}\n\nexport default Tester;\n","import { capitalize } from './utils';\n\n/*\n  Tester Configuration Class\n*/\nclass ConfigurationClass {\n  enzyme;\n  hooks = {};\n  profiles = {\n    // Default profile, each of it's properties can be overwritten.\n    Default: {},\n  };\n  Tester;\n\n  constructor (Tester) {\n    this.Tester = Tester;\n    Tester.Configuration = this;\n  }\n\n  configure (enzyme, config) {\n    this.enzyme = enzyme;\n\n    if (config.hooks) {\n      config.hooks.forEach((hook) => {\n        this.registerHook(hook);\n      });\n    }\n\n    if (config.profiles) {\n      config.profiles.forEach((profile) => {\n        this.registerProfile(profile);\n      });\n    }\n\n    this.createShortcuts();\n\n    return this.Tester;\n  }\n\n  /*\n    Create shortcuts for each global profiles\n    Tester shortcuts allows you to use a specific global profile without having to pass it in in the options.\n\n    E.g.\n    Using a new Tester.Light(MyComponent) allows you to skip the initialization of Transport, localStorage + Session and AppState.\n  */\n  createShortcuts () {\n    Object.keys(this.profiles).forEach((profileKey) => {\n      this.Tester[profileKey] = (TestedComponent, opts = {}) => {\n        return new this.Tester(TestedComponent, {...opts, profile: this.profiles[profileKey]});\n      };\n    });\n  }\n\n  /*\n    Hooks,\n    {\n      name: string,\n      component: React.Component,\n      props: object || fn(), // fn() allows this.AppState to be set for e.g\n      onInit: fn(),\n      onBeforeMount: fn(),\n      shortCuts: {shortCutName: fn()},\n      wrapper: fn() => { Component: React.Component, name: string, props: object }\n    }\n\n    Note: Order is important!\n  */\n  registerHook (hook) {\n    if (!hook.name) { throw new Error('Tester.registerHook() : A hooks must have a name.'); }\n    if (this.hooks[hook.name]) { throw new Error(`Tester.registerHook() : A hook named \"${hook.name}\" already exist.`); }\n\n    // Validate hook properties here.\n\n    this.hooks[hook.name] = hook;\n  }\n\n  /*\n    Profiles,\n    {\n      // Profile keys must be hook names.\n    }\n  */\n  registerProfile (profile) {\n    if (!profile.name) { throw new Error('Tester.registerHook() : A hooks must have a name.'); }\n\n    const capitalizedName = capitalize(profile.name);\n\n    if (this.profiles[capitalizedName] && capitalizedName !== 'Default') {\n      throw new Error(`Tester.registerProfile() : A profile named \"${capitalizedName}\" already exist.`);\n    }\n\n    // Validate profile properties here.\n    //  - Does every key or the profile is a hook ?\n\n    this.profiles[capitalizedName] = profile;\n  }\n\n  getValidHooks (tester, hookProp) {\n    const hooks = [];\n\n    Object.values(this.hooks).forEach((hook) => {\n      let valid = true;\n      if (!tester.profile[hook.name]) { valid = false; }\n      if (hookProp && !hook[hookProp]) { valid = false; }\n\n      if (valid) {\n        hooks.push(hook);\n      }\n    });\n\n    return hooks;\n  }\n\n}\n\nexport default ConfigurationClass;\n","import Tester from './tester';\nimport ConfigurationClass from './ConfigurationClass';\n\nconst TesterConfig = new ConfigurationClass(Tester);\n\nexport {\n  Tester,\n  TesterConfig,\n}\n"],"names":["getInstance","component","instance","wrappedInstance","getValue","tester","value","sleep","ms","Promise","resolve","setTimeout","capitalize","string","charAt","toUpperCase","slice","NullComponent","props","React","Fragment","Tester","TestedComponent","opts","config","constructor","Configuration","initialMount","mount","onBeforeMount","profile","profiles","Default","getValidHooks","forEach","hook","onInit","wrappers","push","name","console","log","wrapper","debug","html","text","selector","find","update","shallow","enzyme","AppState","mountOpts","WrapperTree","getWrappers","reduce","Tree","wrapperChildren","renderChildren","createShallowWrapper","async","ConfigurationClass","hooks","registerHook","registerProfile","createShortcuts","Object","keys","profileKey","Error","capitalizedName","hookProp","values","valid","TesterConfig"],"mappings":"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"}